<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>

  <!-- Include the styles for the Netlify CMS UI, after your own styles -->
  <link rel="stylesheet" href="/admin/cms/cms.css" />

</head>
<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="/admin/cms/cms.js"></script>
<script>
CMS.registerEditorComponent({
  // Internal id of the component
  id: "youtube",
  // Visible label
  label: "Youtube",
  // Fields the user need to fill out when adding an instance of the component
  fields: [{name: 'id', label: 'Youtube Video ID', widget: 'string'}],
  // Pattern to identify a block as being an instance of this component
  pattern: /^{{< youtube (\S+) >}}$/,
  // Function to extract data elements from the regexp match
  fromBlock: function(match) {
    return {
      id: match[1]
    };
  },
  // Function to create a text block from an instance of this component
  toBlock: function(obj) {
    return '{{< youtube ' + obj.id + ' >}}';
  },
  // Preview output for this component. Can either be a string or a React component
  // (component gives better render performance)
  toPreview: function(obj) {
    return (
      `<img src="http://img.youtube.com/vi/${obj.id}/maxresdefault.jpg" alt="Youtube Video"/>`
    );
  }
});

CMS.registerEditorComponent({
  // Internal id of the component
  id: "figure",
  // Visible label
  label: "Figure",
  // Fields the user need to fill out when adding an instance of the component
  fields: [
    {name: 'src', label: 'Image', widget: 'image'},
    {name: 'link', label: 'Link', widget: 'string'},
    {name: 'target', label: 'Target window', widget: 'string'},
    {name: 'rel', label: 'Rel (optional if link set)', widget: 'string'},
    {name: 'alt', label: 'Image alternate text', widget: 'string'},
    {name: 'title', label: 'Figure title', widget: 'string'},
    {name: 'caption', label: 'Figure caption', widget: 'string'},
    {name: 'className', label: 'HTML class', widget: 'string'},
    {name: 'height', label: 'Image height', widget: 'number', min: 1},
    {name: 'width', label: 'Image width', widget: 'string', min: 1},
    {name: 'attr', label: 'Figure attribution text', widget: 'string'},
    {name: 'attrlink', label: 'Figure attribution link', widget: 'string'}
  ],
  // Pattern to identify a block as being an instance of this component
  pattern: /^{{< figure src="(\S*)" link="(\S*)" target="(\S*)" rel="(\S*)" alt="(\S*)" title="(\S*)" caption="(\S*)" class="(\S*)" height="(\S*)" width="(\S*)" attr="(\S*)" attrlink="(\S*)" >}}$/,
  // Function to extract data elements from the regexp match
  fromBlock: function(match) {
    return {
      src: match[1],
      link: match[2],
      target: match[3],
      rel: match[4],
      alt: match[5],
      title: match[6],
      caption: match[7],
      className: match[8],
      height: match[9],
      width: match[10],
      attr: match[11],
      attrlink: match[12]
    };
  },
  // Function to create a text block from an instance of this component
  toBlock: function(obj) {
    return `{{< figure src="${obj.src}" link="${obj.link}" target="${obj.target}" rel="${obj.rel}" alt="${obj.alt}" title="${obj.title}" caption="${obj.caption}" class="${obj.className}" height="${obj.height}" width="${obj.width}" attr="${obj.attr}" attrlink="${obj.attrlink}" >}}`;
  },
  // Preview output for this component. Can either be a string or a React component
  // (component gives better render performance)
  toPreview: function(obj) {
    return (
      `
      <figure>
        <h3>${obj.title}</h3>
        <a href="${obj.link}" rel="${obj.rel}" target="${obj.target}">
        <img src="${obj.src}" alt="${obj.alt}" width="${obj.width}" height="${obj.height}" />
        </a>
        <figcaption>
          <h4 class="${obj.className}">${obj.caption}</h4>
        </figcaption>
        <small><a href="${obj.attrlink}">${obj.attr}</a></small>
      </figure>
      `
    );
  }
});

CMS.registerEditorComponent({
  // Internal id of the component
  id: "gist",
  // Visible label
  label: "Gist",
  // Fields the user need to fill out when adding an instance of the component
  fields: [
    {name: 'user', label: 'Github User', widget: 'string'},
    {name: 'gist', label: 'Gist ID', widget: 'string'}
  ],
  // Pattern to identify a block as being an instance of this component
  pattern: /^{{< gist (\S*) (\S*) >}}$/,
  // Function to extract data elements from the regexp match
  fromBlock: function(match) {
    return {
      user: match[1],
      gist: match[2]
    };
  },
  // Function to create a text block from an instance of this component
  toBlock: function(obj) {
    return `{{< gist ${obj.user} ${obj.gist} >}}`;
  },
  // Preview output for this component. Can either be a string or a React component
  // (component gives better render performance)
  toPreview: function(obj) {
    return (
      `<script src="//gist.github.com/${obj.user}/${obj.gist}.js"></script>`
    );
  }
});

</script>
</body>
</html>