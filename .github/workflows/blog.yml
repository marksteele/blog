name: build-blog
on: [push]
jobs:
  do-the-thing:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: recursive
      - run: sudo apt-get install python-pygments imagemagick
      - run: sudo wget -qO hugo_0.55.6_Linux-64bit.deb https://github.com/gohugoio/hugo/releases/download/v0.55.6/hugo_0.55.6_Linux-64bit.deb
      - run: sudo dpkg -i hugo_0.55.6_Linux-64bit.deb
      - shell: bash
        run: |
          for i in `find static/images/galleries -type f ! -name "*-thumb.jpg" -name "*.jpg"`; do echo $i; if [ -f ${i%.*}-thumb.jpg ]; then continue; fi; convert $i -thumbnail 100x100 ${i%.*}-thumb.jpg; done
      - run: hugo
      - shell: bash
        run: |
          cd public
          git config user.email "mark@control-alt-del.org"
          git config user.name "Mark Steele"
          git add public
          git commit -m 'Site push'
      - name: Push changes
        uses: ad-m/github-push-action@master
          with:
            github_token: ${{ secrets.PAT }}
            branch: master
            directory: public
            repository: marksteele/marksteele.github.io
